# AstraRP: 模块化智能体角色扮演流水线 (Modular Agent Pipeline for RP)

**AstraRP** 是一个基于 **[llama.cpp](https://github.com/ggml-org/llama.cpp.git)** 的，专为深度角色扮演（Role-Play）设计的下一代智能体架构。

不同于传统的大型单体模型（Monolithic LLMs），AstraRP 采用 **“模型即算子”** 的设计哲学，将复杂的 RP 逻辑拆解为由多个微型模型（0.5B - 7B）构成的有向无环图（DAG）流水线。

### 核心理念：解构黑箱

传统的 RP 模型往往面临 **“性能与硬件要求不成正比”**、**“人设崩坏难以定位原因”** 等痛点。AstraRP 通过以下方式解决：

- **原子化任务**：将好感度计算、意图识别、心理状态更新等任务交由专精的 1.5B 级别小模型处理。
- **透明化决策**：每一层的输出（JSON/数值）均可实时监控，彻底解决 RP 中的“逻辑黑箱”问题。
- **异构加速**：针对 CPU 环境进行并行优化，通过调度多个小模型协同工作，达到甚至超越 70B 级别模型的逻辑深度。

---

## 架构设计 (Architecture)

大体上，AstraRP 将角色逻辑分为五个核心层级：

1. **上下文层 (Context Layer)**:
    - **输入**：原始上下文信息。
    - **模型**：上下文总结专家模型及可选的嵌入式模型。
    - **输出**：总结后的上下文信息。
2. **感知层 (Perception Layer)**:
    - **输入**：总结后的上下文信息。
    - **模型**：0.5B - 1.5B 模型（如 Qwen-1.5B-Chat / Phi-3）。
    - **输出**：意图标签、情绪向量、身份校验信息。
3. **状态层 (Cognitive State Layer)**:
    - **功能**：维护好感度、心情等可量化数值。
    - **模型**：1.5B 状态更新模型。
    - **输出**：更新后的角色状态剖面数据。
4. **决策层 (Strategic Layer)**:
    - **功能**：根据状态与感知结果，规划“下一步该做什么”。
    - **模型**：1.5B - 7B 逻辑增强模型。
    - **输出**：行动策略（如：`{动作: 避开眼神, 语调: 羞涩}`）。
5. **表现层 (Presentation Layer)**:
    - **功能**：最终文本润色与文笔渲染。
    - **模型**：7B 专攻文笔的微调模型（如 Llama-3-8B 变体）。

---

## 视觉化工作流 (Astra Canvas)

AstraRP 提供了一个基于 WebUI 的 **节点连接编辑器**：

- **节点化管理**：每个微调好的模型都是一个节点，可以自由连接。
- **实时调试**：点击任何节点之间的连线，即可查看流转的结构化数据。
- **动态替换**：在不停止服务的情况下，热切换某个模块（例如将“好感度模块”从 v1 升级到 v2）。

---

## 数据构造与可复现性 (Dataset Construction)

本仓库不仅提供推理架构，还包含完整的 **数据生产工厂**，以确保微调结果的可复现性。

### 数据流管线：

- `scripts/gen_intent_data.py`: 基于 Self-Instruct 自动生成意图识别数据集。
- `scripts/distill_cognition.py`: 利用大模型（如 GPT-4）对 RP 语料进行标注，提取心理状态变迁过程，用于小模型蒸馏。
- `scripts/format_converter.py`: 将原始对话转换为 AstraRP 特有的结构化多轮训练格式。

---

## 路线图 (Roadmap)

- [ ] **Phase 1: 验证可行性** (当前阶段)
  - 微调 1.5B 意图识别器与 1.5B 心理状态模型。
  - 构建基础 Pipeline 框架。
- [ ] **Phase 2: 框架搭建与多语言绑定**
  - 初步搭建可行流水线框架。
  - 完成模型间参数对接与高扩展性接口设计。
- [ ] **Phase 3: 节点编辑器开发**
  - 开发可视化 WebUI。
  - 实现模型节点的异步调度（Async Inference）。
- [ ] **Phase 4: 社区生态**
  - 开放 Hub，允许用户分享自己训练的特定“功能节点”（如：专攻“傲娇”性格的决策模型）。

---

## 快速开始 (Quick Start)

此处暂处于不可用状态！

```bash
git clone https://github.com/YourUsername/AstraRP.git
cd AstraRP
```

---

## 贡献与讨论

AstraRP 仍在早期开发阶段。如果你对“分布式智能体架构”或“小模型驱动的高级 RP”感兴趣，欢迎提交 Issue 或 Pull Request。

**项目负责人**: [pjh456](https://github.com/pjh456)

---

### 为什么选择这个名字？

**Astra** 源自拉丁语“星辰”。在 AstraRP 中，每一个微小的模型就像一颗星辰，虽然微弱，但通过引力（流水线）连接在一起，便构成了璀璨的星系（完整的智能人格）。